# Тестовое задание "Сервис уведомлений"

## Техническое задание
#### Задача

Необходимо разработать сервис управления рассылками API администрирования и получения статистики.


#### Описание

Необходимо реализовать методы создания новой рассылки, просмотра созданных и получения статистики по выполненным рассылкам.

Реализовать сам сервис отправки уведомлений на внешнее API.

Опционально вы можете выбрать любое количество дополнительных пунктов описанных после основного.

Для успешного принятия задания как выполненного достаточно корректной и рабочей реализации требований по основной части, но дополнительные пункты помогут вам продемонстрировать ваши навыки в смежных технологиях.

## Выполненные дополнительные задания.
1 организовать тестирование написанного кода

3 подготовить docker-compose для запуска всех сервисов проекта одной командой

5 сделать так, чтобы по адресу /docs/ открывалась страница со Swagger UI и в нём отображалось описание разработанного API.

9 удаленный сервис может быть недоступен, долго отвечать на запросы или выдавать некорректные ответы. Необходимо организовать обработку ошибок и откладывание запросов при неуспехе для последующей повторной отправки. Задержки в работе внешнего сервиса никак не должны оказывать влияние на работу сервиса рассылок.

11 реализовать дополнительную бизнес-логику: добавить в сущность "рассылка" поле "временной интервал", в котором можно задать промежуток времени, в котором клиентам можно отправлять сообщения с учётом их локального времени. Не отправлять клиенту сообщение, если его локальное время не входит в указанный интервал.


### API сервиса можно получить <сервер>/docs/: 

  
## Установка
Выполнить следующие действия:

Клонировать репозиторий: `git clone https://gitlab.com/Kandrey/fabrique_test.git`

### Без DOCKER
Создать виртуальное окружение командой: `python -m venv venv`

Активировать виртуальное окружение `venv\Scripts\activate.bat`

Установить пакеты в виртуальное окружение: `pip install -r requirements.txt`

Перейти в директорию: `cd notificationdrf`

Создать файл .env (образец .env_sample).

(У Вас должны быть установлены Redis (localhost:6379) если они на других
портах необходимо будет указать их в конфигурациях (.env)) 

Создать миграцию `python manage.py makemigrations`

Выполнить миграцию `python manage.py migrate`

В отдельных консолях:
 - Запустить приложение `python manage.py runserver`

 - Запустить worker `python -m celery -A notificationdrf worker -l info --purge -P eventlet`

 - Запустить worker beat `python -m celery -A notificationdrf beat -l INFO`

Приложение запущено.

### Используя DOCKER
Создать файл .env_docker (образец .env_sample).

Установить в файле .env параметры: 
 - CELERY_BROKER_URL=redis://redis:6379/0
 - CELERY_RESULT_BACKEND=redis://redis:6379/0

Выполнить команду `docker-compose up --build -d`

Приложение запущено.

## Тестирование
Для ручного тестирования можно сгенерировать тестовые данные
командой `python manage.py create_test_data` или добавить администратора 
командой `python manage.py add_admin` (параметры задаются в файле 
переменных окружения ".env") и внести вручную через панель администратора. 

Для автоматического тестирования установить зависимости командой
`pip install -r requirements-dev.txt`

Выполнить команду `pytest tests` находясь в каталоге `notificationsrf`

